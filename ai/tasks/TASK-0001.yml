version: 1
id: TASK-0001
plan_id: PLAN-0001
status: done # todo|doing|blocked|done
priority: P1

title: Desktop Rules schema/example alignment check + document update procedure
description: >
  Compare the builtin.desktop desktop_rules schema and example, and document
  compatibility rules and update procedures under `ai/` for future changes.

acceptance_criteria:
  - No mismatch between schema and example (validation passes)
  - Any breaking change is explicitly noted with migration guidance

scope:
  contracts:
    - contracts/plugins/builtin.desktop/schemas/desktop_rules.schema.json
    - contracts/plugins/builtin.desktop/examples/desktop_rules.example.yml
  docs:
    - ai/plans/PLAN-0001-desktop-dsl.yml

notes:
  - If implementation changes are required, split into a separate task

results:
  changes:
    - Added plugin contract example validation:
        - tests/contract/test_plugin_contract_examples.py
        - scripts/check_contracts.py
    - Hardened desktop rules schema to prevent accidental match-all rules:
        - desktop_rules.schema.json now requires match.any or match.all to be non-empty
  migration_guidance:
    - If you previously relied on `match: {}` (match-all), replace it with an explicit atom such as:
        - match:
            any:
              - filename_regex: ".*"


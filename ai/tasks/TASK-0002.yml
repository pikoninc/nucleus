version: 1
id: TASK-0002
plan_id: PLAN-0001
title: builtin_desktop planner DSL safety review (validation/defaults)
status: done # todo|doing|blocked|done
priority: P1

description: >
  Review DSL ingestion, default values, and error messages in
  `plugins/builtin_desktop/planner.py`, and strengthen validation if needed.

acceptance_criteria:
  - Invalid input yields clear errors
  - Existing tests pass, and new tests are added if needed

scope:
  code:
    - plugins/builtin_desktop/planner.py
  tests:
    - tests/plugins/test_builtin_desktop_planner_config.py

notes:
  - If compatibility changes, record the rationale in the PLAN and TASK

results:
  changes:
    - Expanded `~` when comparing config root/staging against `scope.fs_roots` (avoids false scope denial)
    - Rejected unsafe `move_to` subpaths (absolute or containing `..`) to prevent path traversal out of staging_dir
    - Improved schema validation error payload (`path`, `schema_path`, concise `error`)
  tests:
    - Extended tests/plugins/test_builtin_desktop_planner_config.py (TDD)

